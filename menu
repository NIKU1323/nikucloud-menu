#!/bin/bash

# === Variabel Dasar ===
domain="nikucloud.my.id"
xray_dir="/etc/xray"
cert_dir="/etc/ssl/xray"
uuid=$(grep -oP '"id":\s*"\K[^"]+' $xray_dir/config.json | head -n1)
ip=$(wget -qO- ipinfo.io/ip)
slowdns_domain="ns1.nikucloud.my.id"

# === Warna ===
red='\e[1;31m'
green='\e[1;32m'
blue='\e[1;34m'
yellow='\e[1;33m'
nc='\e[0m'

# === Header Menu ===
clear
echo -e "${green}==== MENU VPN SERVER - NIKU CLOUD ====${nc}"
echo -e "IP VPS     : $ip"
echo -e "DOMAIN     : $domain"
echo -e "UUID AKTIF : $uuid"
echo "======================================="
echo -e "1. SSH + OVPN MANAGER"
echo -e "2. VMESS MANAGER"
echo -e "3. VLESS MANAGER"
echo -e "4. TROJAN MANAGER"
echo -e "5. SHADOWSOCKS MANAGER"
echo -e "6. TAMPILKAN LINK"
echo -e "7. RESET AKUN SSH"
echo -e "8. LOG LOGIN SSH"
echo -e "9. BACKUP KONFIGURASI"
echo -e "10. EXIT"
echo -e "11. QR CODE LINK AKUN"
echo -e "12. PERPANJANG AKUN SSH"
echo -e "13. INSTALL ULANG XRAY"
echo -e "14. PERPANJANG AKUN XRAY"
echo -e "15. SLOWDNS MANAGER"
echo -e "16. LIHAT SEMUA AKUN AKTIF"
echo -e "17. AUTO INSTALL SSL (LET'S ENCRYPT)"
echo "======================================="
read -rp "Pilih menu [1-17] : " menu

case $menu in
# ... (menu sebelumnya tetap sama)

17)
  echo -e "${blue}== AUTO INSTALL SSL LET'S ENCRYPT ==${nc}"
  echo -e "üîß Domain: $domain"
  echo -e "üîê Sertifikat akan dipasang ke: $cert_dir"
  echo -e "‚ö†Ô∏è Pastikan domain sudah mengarah ke IP VPS ($ip)"
  read -rp "Lanjutkan install SSL untuk domain ini? (y/n): " confirm
  if [[ "$confirm" == "y" ]]; then
    apt install socat curl cron -y
    curl https://acme-install.netlify.app/acme.sh -o acme.sh && bash acme.sh
    ~/.acme.sh/acme.sh --set-default-ca --server letsencrypt
    ~/.acme.sh/acme.sh --issue -d $domain --standalone -k ec-256
    ~/.acme.sh/acme.sh --install-cert -d $domain --ecc \
      --key-file $cert_dir/private.key \
      --fullchain-file $cert_dir/cert.crt
    chmod 600 $cert_dir/*
    echo -e "‚úÖ SSL berhasil dipasang untuk $domain"
    echo -e "üîÑ Restarting Xray..."
    systemctl restart xray
  else
    echo "‚ùå Batal memasang SSL."
  fi
  ;;

*)
  echo "Menu tidak valid."
  ;;
esac
